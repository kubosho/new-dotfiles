# devbox: skip PATH replacement to preserve commonenv's priority order
eval "$(devbox global shellenv | grep -v '^export PATH=')"
eval "$(mise activate zsh)"

# Sheldon plugin manager
eval "$(sheldon source)"

# Completion settings
autoload -Uz compinit && compinit

eval "$(starship init zsh)"

# Force non-blinking bar cursor on each prompt
# Ghostty's cursor-style-blink=false only sets the initial state;
# applications can override it via DECSCUSR escape sequences.
zle-line-init() { printf '\e[6 q' }
zle -N zle-line-init

# ghq + fzf: select repository and cd into it
gf() {
  local repo=$(ghq list | fzf)
  if [ -n "$repo" ]; then
    cd "$(ghq root)/$repo"
  fi
}

# Key bindings for history navigation
# up-line-or-search: filters history by current input, or navigates normally if empty
bindkey '^P' up-line-or-search
bindkey '^N' down-line-or-search

# Google Cloud
if [ -f "${XDG_BIN_HOME}/google-cloud-sdk/path.zsh.inc" ]; then . "${XDG_BIN_HOME}/google-cloud-sdk/path.zsh.inc"; fi
if [ -f "${XDG_BIN_HOME}/google-cloud-sdk/completion.zsh.inc" ]; then . "${XDG_BIN_HOME}/google-cloud-sdk/completion.zsh.inc"; fi
